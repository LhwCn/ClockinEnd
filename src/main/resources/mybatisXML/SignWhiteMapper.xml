<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itlozg.admin.mapper.SignWhiteMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.itlozg.admin.entity.SignWhite">
        <id column="id" property="id"/>
        <result column="created_by" property="createdBy"/>
        <result column="creation_date" property="creationDate"/>
        <result column="del_flag" property="delFlag"/>
        <result column="last_updated_by" property="lastUpdatedBy"/>
        <result column="last_update_date" property="lastUpdateDate"/>
        <result column="remarks" property="remarks"/>

        <result column="user_id" property="userId"/>
        <result column="rule_id" property="ruleId"/>
    </resultMap>

    <!--查询用户白名单-->
    <select id="findWhiteByRuleId" resultMap="BaseResultMap" resultType="com.itlozg.admin.entity.SignWhite">
         select * from sign_white
         where del_flag='0' and rule_id=#{ruleId}
    </select>

    <!--查询用户白名单-->
    <select id="findWhiteByRuleIdUserId" resultMap="BaseResultMap" resultType="com.itlozg.admin.entity.SignWhite">
         select * from sign_white
         where del_flag='0' and rule_id=#{ruleId} and user_id=#{userId}
    </select>

    <select id="getWhitesInUse" resultMap="BaseResultMap">
        select user_id,rule_id from sign_white where del_flag='0'
        and rule_id in (select rule_id from sign_final where del_flag='0' group by rule_id)
    </select>

    <!--删除白名单-->
    <update id="deleteByRuleId">
        update sign_white set del_flag='1'
        where rule_id=#{ruleId}
    </update>

</mapper>
